CREATE OR REPLACE VIEW AI_FEATURE_HUB.V_BILLING_SUMMARY AS SELECT br.BILLING_RUN_ID,br.ACCOUNT_ID,br.RUN_PERIOD_START,br.RUN_PERIOD_END,br.SUBTOTAL,br.MARKUP_TOTAL,br.TAXES,br.TOTAL_DUE, ARRAY_AGG(OBJECT_CONSTRUCT('feature_key',bli.FEATURE_KEY,'usage_qty',bli.UNITS,'base_cost',bli.UNIT_PRICE,'line_total',bli.LINE_TOTAL)) AS LINE_ITEMS FROM AI_FEATURE_HUB.BILLING_RUN br JOIN AI_FEATURE_HUB.BILLING_LINE_ITEM bli ON br.BILLING_RUN_ID=bli.BILLING_RUN_ID GROUP BY br.BILLING_RUN_ID,br.ACCOUNT_ID,br.RUN_PERIOD_START,br.RUN_PERIOD_END,br.SUBTOTAL,br.MARKUP_TOTAL,br.TAXES,br.TOTAL_DUE