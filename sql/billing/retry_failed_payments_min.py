from snowflake.snowpark import Session;def process_payment_for_failed(session:Session):q="SELECT i.INVOICE_ID,i.TOTAL,i.CURRENCY,p.PAYMENT_METHOD FROM AI_FEATURE_HUB.SUBSCRIPTION_INVOICES i JOIN AI_FEATURE_HUB.INVOICE_PAYMENTS p ON i.INVOICE_ID=p.INVOICE_ID WHERE p.STATUS='FAILED' AND p.CREATED_AT>=DATEADD('day',-7,CURRENT_TIMESTAMP())";failed=session.sql(q).collect();res=[];for p in failed:res.append({'invoice_id':p['INVOICE_ID'],'amount':p['TOTAL'],'action':'RETRY_ATTEMPTED'});return {'retried_payments':res}