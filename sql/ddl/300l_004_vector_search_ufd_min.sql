CREATE OR REPLACE FUNCTION AI_FEATURE_HUB.FIND_SIMILAR(embedding VARIANT,top_k NUMBER) RETURNS VARIANT LANGUAGE SQL AS $$ SELECT ARRAY_AGG(OBJECT_CONSTRUCT('emb_id',e.emb_id,'document_id',e.document_id,'score',1/(1+SQRT(ARRAY_SUM((e.embedding-:1)*(e.embedding-:1)))) ) ORDER BY 3 DESC LIMIT :2) FROM AI_FEATURE_HUB.DOCUMENT_EMBEDDINGS e; $$;