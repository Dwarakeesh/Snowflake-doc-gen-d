CREATE OR REPLACE PROCEDURE AI_FEATURE_HUB.CHECK_MODEL_P95_ALERT(threshold NUMBER DEFAULT 2000) RETURNS VARIANT LANGUAGE SQL AS $$ insert into AI_FEATURE_HUB.ALERTS (ALERT_ID,NAME,DETAILS,CREATED_AT) select uuid_string(),'MODEL_P95_HIGH',object_construct('model',model_id,'account',account_id,'p95',p95),current_timestamp() from (select model_id,account_id,approx_percentile(latency_ms,0.95) p95 from AI_FEATURE_HUB.MODEL_TELEMETRY where created_at>=dateadd(hour,-1,current_timestamp()) group by model_id,account_id) where p95>threshold; $$;