CREATE OR REPLACE PROCEDURE AI_FEATURE_HUB.UPSERT_RATECARD(rate_id STRING,feature_key STRING,base_unit_price NUMBER,currency STRING,valid_from DATE,valid_to DATE) RETURNS VARIANT LANGUAGE SQL AS $$ MERGE INTO AI_FEATURE_HUB.RATE_CARD r USING (SELECT :1 rate_id,:2 feature_key,:3 base_unit_price,:4 currency,:5 valid_from,:6 valid_to) s ON r.RATE_ID=s.rate_id WHEN MATCHED THEN UPDATE SET BASE_UNIT_PRICE=s.base_unit_price,CURRENCY=s.currency,VALID_FROM=s.valid_from,VALID_TO=s.valid_to WHEN NOT MATCHED THEN INSERT (RATE_ID,FEATURE_KEY,BASE_UNIT_PRICE,CURRENCY,VALID_FROM,VALID_TO) VALUES (s.rate_id,s.feature_key,s.base_unit_price,s.currency,s.valid_from,s.valid_to); CALL AI_FEATURE_HUB.RECORD_RATE_CHANGE(:1,:2,:3,:4,:5,:6); RETURN 'OK'; $$;GRANT EXECUTE ON PROCEDURE AI_FEATURE_HUB.UPSERT_RATECARD TO ROLE YOUR_RUN_ROLE;