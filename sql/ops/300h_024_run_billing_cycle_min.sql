CREATE OR REPLACE PROCEDURE AI_FEATURE_HUB.RUN_BILLING_CYCLE(billing_date DATE) RETURNS VARIANT LANGUAGE SQL AS $$ DECLARE cur CURSOR FOR SELECT ACCOUNT_ID FROM AI_FEATURE_HUB.V_BILLING_MONTH WHERE BILLING_DATE=:billing_date; BEGIN FOR rec IN cur DO CALL AI_FEATURE_HUB.CREATE_BILLING_PERIOD(rec.ACCOUNT_ID,:billing_date); CALL AI_FEATURE_HUB.RUN_BILLING(:billing_date,rec.ACCOUNT_ID); CALL AI_FEATURE_HUB.CLOSE_BILLING_PERIOD(rec.ACCOUNT_ID,:billing_date); END FOR; RETURN 'ok'; END; $$;