CREATE OR REPLACE PROCEDURE AI_FEATURE_HUB.DAILY_USAGE_AGG() RETURNS VARIANT LANGUAGE SQL AS $$ INSERT INTO AI_FEATURE_HUB.USAGE_DAILY(AGG_ID,ACCOUNT_ID,FEATURE_KEY,DAY,TOTAL_UNITS) SELECT LEFT(GENERATOR_RANDOM_STRING(),36),ACCOUNT_ID,FEATURE_KEY,DATE_TRUNC('DAY',USAGE_TIMESTAMP),SUM(UNITS) FROM AI_FEATURE_HUB.TENANT_FEATURE_USAGE WHERE USAGE_TIMESTAMP>=DATEADD(day,-1,CURRENT_TIMESTAMP()) GROUP BY ACCOUNT_ID,FEATURE_KEY,DATE_TRUNC('DAY',USAGE_TIMESTAMP); RETURN 'OK'; $$;GRANT EXECUTE ON PROCEDURE AI_FEATURE_HUB.DAILY_USAGE_AGG TO ROLE YOUR_RUN_ROLE;