CREATE OR REPLACE PROCEDURE AI_FEATURE_HUB.APPLY_MARKUP_TO_INVOICE(invoice_id STRING) RETURNS VARIANT LANGUAGE SQL AS $$ UPDATE AI_FEATURE_HUB.SUBSCRIPTION_INVOICES SET MARKUP = (SELECT p.MARKUP_PERCENT FROM AI_FEATURE_HUB.PRICING_TIERS p JOIN AI_FEATURE_HUB.ORGANIZATION o ON o.tier=p.NAME WHERE o.account_id=AI_FEATURE_HUB.SUBSCRIPTION_INVOICES.ACCOUNT_ID LIMIT 1)/100*SUBTOTAL WHERE INVOICE_ID=:1; RETURN 'OK'; $$;GRANT EXECUTE ON PROCEDURE AI_FEATURE_HUB.APPLY_MARKUP_TO_INVOICE TO ROLE YOUR_RUN_ROLE;